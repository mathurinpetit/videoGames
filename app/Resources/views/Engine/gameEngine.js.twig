{% if mobile %}
    {% autoescape %}
    var pathGame = "{{ '/bundles/videogame/video/'~game.videoPath~'/mobile/' | raw }}";
    {% endautoescape %}
{% else %}
    {% autoescape %}
    var pathGame = "{{ '/bundles/videogame/video/'~game.videoPath~'/' | raw }}";
    {% endautoescape %}
{% endif %}

{{ include('Engine/gamelib.js.twig') }}

var game_json = {{ include('Games/'~game.shortName~'.json', { 'game': game }) }};
var debug = false;
var debug_script   = false;
var hascookie = game_json.cookie;
var cookieKey = "{{ game.name }}";
var cookieValue = "{{ game.shortName }}";


{% if mobile %}
var mobile = true;
{% else %}
var mobile = false;
{% endif %}
var debug = false;
var debug_script   = false;
var game_json = {{ include('Games/'~game.shortName~'.json', { 'game': game }) }};
var gamekeys = game_json.gamekeys;

var anchor = window.location.hash;
var anchorValue = anchor.substring(anchor.indexOf("#")+1);

var firstVideoNumber = game_json.debugstart ;
var cookieVid = null;
if(hascookie){
    createCookieOrBackToMenu(cookieKey,cookieValue);
    var c = readCookie(cookieKey.replace(" ",""));
    if(c){
        var startVid = readCookie(c);
        if(startVid){
            firstVideoNumber = startVid;
        }
    }
}



video = document.getElementById( 'video_'+ firstVideoNumber );

if(debug){
  video.onloadedmetadata = function() {
    video.currentTime = ""+video.duration - 0.1;
  };
}

var lastVideoPlayed = { "val" : ""+firstVideoNumber };

{% if urlgame %}
 {{ include('Games/gameUrlInitialization.js.twig', { 'game': game , 'urlgame' : urlgame, 'mobile' : mobile }) }}
{% else %}
 {{ include('Games/gameEventsManager.js.twig', { 'game': game , 'urlgame' : urlgame, 'mobile' : mobile }) }}
{% endif %}
if(video){
 video.onloadeddata = function(){
    {% if not urlgame %}
        initDivLoadingShowHide(video);
    {% endif %}
    $("#divLoading").hide();
 };
}else{
    $("#divLoading").hide();
}

$("#startGame").click(function(){
    video.play();
    $("#startButton").remove();

});

if(mobile){
    $(window).on("resize orientationchange",onWindowResizeMobile);

    $("a").each(function(){
        if(!$(this).hasClass('share') && !$(this).hasClass('popupPartage')){
            $(this).attr("href", "http://"+location.host+"/mobile");
            $(this).attr("data-ajax","false");
        }

    });
}


$('a.share').click(function(e){
	e.preventDefault();
	var $link   = $(this);
	var href    = $link.attr('href').replace('URLENCODED',encodeURI(get_short_url())).replace('TITLE',$(document).title);
	var network = $link.attr('data-network');

	var networks = {
		facebook : { width : 600, height : 300 },
		twitter  : { width : 600, height : 254 },
		google   : { width : 515, height : 490 },
		linkedin : { width : 600, height : 473 }
	};

	var popup = function(network){
		var options = 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,';
		window.open(href, '', options+'height='+networks[network].height+',width='+networks[network].width);
	}

	popup(network);
});
